(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[954],{6954:function(e,t,r){Promise.resolve().then(r.bind(r,6205))},6205:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var n=r(3827),s=r(4090),a=r(2131),i=r(9902),l=r(5671),o=r(575),d=r(3277),c=r(8685),u=r(2782),f=r(2647),m=r(6288),x=r(2959);function h(){let{user:e}=(0,a.a)(),[t,r]=(0,s.useState)([]),[h,g]=(0,s.useState)(null),[p,v]=(0,s.useState)([]),[y,b]=(0,s.useState)(""),[j,N]=(0,s.useState)(""),[w,_]=(0,s.useState)(!0);(0,s.useEffect)(()=>{C()},[e]),(0,s.useEffect)(()=>{h&&I(h.id)},[h]);let C=async()=>{try{let{data:t,error:n}=await i.O.from("invoices").select("\n          *,\n          clients!inner (\n            id,\n            name,\n            client_portal_access!inner (\n              user_id\n            )\n          )\n        ").eq("clients.client_portal_access.user_id",null==e?void 0:e.id).order("created_at",{ascending:!1});if(n)throw n;r(t||[])}catch(e){m.toast.error("Failed to fetch invoices"),console.error(e)}finally{_(!1)}},I=async e=>{try{let{data:t,error:r}=await i.O.from("payments").select("*").eq("invoice_id",e).order("payment_date",{ascending:!1});if(r)throw r;v(t||[])}catch(e){console.error("Failed to fetch payments:",e)}},O=async()=>{if(!h||!y){m.toast.error("Please fill in all required fields");return}try{let{error:e}=await i.O.from("payments").insert({invoice_id:h.id,amount:h.total_amount,payment_method:y,client_comment:j,paid_by_client:!0});if(e)throw e;let{error:t}=await i.O.from("invoices").update({status:"paid"}).eq("id",h.id);if(t)throw t;m.toast.success("Payment recorded successfully!"),b(""),N(""),C(),I(h.id)}catch(e){m.toast.error("Failed to record payment"),console.error(e)}},M=e=>{switch(e){case"paid":return"bg-green-100 text-green-800";case"overdue":return"bg-red-100 text-red-800";case"sent":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return w?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,n.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading your invoices..."})]})}):(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,n.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Client Portal"}),(0,n.jsx)("p",{className:"text-gray-600 mt-2",children:"View and manage your invoices"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold",children:"Your Invoices"}),t.map(e=>(0,n.jsxs)(l.Zb,{className:"cursor-pointer transition-colors hover:bg-gray-50 ".concat((null==h?void 0:h.id)===e.id?"ring-2 ring-blue-500":""),onClick:()=>g(e),children:[(0,n.jsx)(l.Ol,{className:"pb-3",children:(0,n.jsxs)("div",{className:"flex justify-between items-start",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(l.ll,{className:"text-lg",children:e.invoice_number}),(0,n.jsx)(l.SZ,{children:e.title})]}),(0,n.jsx)(d.C,{className:M(e.status),children:e.status})]})}),(0,n.jsx)(l.aY,{children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("span",{className:"text-2xl font-bold",children:["$",e.total_amount.toFixed(2)," ",e.currency]}),(0,n.jsxs)("span",{className:"text-sm text-gray-500",children:["Due: ",(0,x.WU)(new Date(e.due_date),"MMM dd, yyyy")]})]})})]},e.id))]}),(0,n.jsx)("div",{children:h?(0,n.jsxs)(l.Zb,{children:[(0,n.jsxs)(l.Ol,{children:[(0,n.jsx)(l.ll,{children:"Invoice Details"}),(0,n.jsx)(l.SZ,{children:h.title})]}),(0,n.jsxs)(l.aY,{children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"font-semibold",children:"Amount:"}),(0,n.jsxs)("span",{children:["$",h.total_amount.toFixed(2)," ",h.currency]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"font-semibold",children:"Status:"}),(0,n.jsx)(d.C,{className:M(h.status),children:h.status})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"font-semibold",children:"Due Date:"}),(0,n.jsx)("span",{children:(0,x.WU)(new Date(h.due_date),"MMM dd, yyyy")})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"font-semibold",children:"Issued:"}),(0,n.jsx)("span",{children:(0,x.WU)(new Date(h.issue_date),"MMM dd, yyyy")})]})]}),"paid"!==h.status&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(f._,{htmlFor:"paymentMethod",children:"Payment Method"}),(0,n.jsx)(u.I,{id:"paymentMethod",value:y,onChange:e=>b(e.target.value),placeholder:"e.g. Bank Transfer, Credit Card",required:!0}),(0,n.jsx)(f._,{htmlFor:"paymentComment",children:"Comment (optional)"}),(0,n.jsx)(c.g,{id:"paymentComment",value:j,onChange:e=>N(e.target.value),placeholder:"Add a comment for the business..."}),(0,n.jsx)(o.z,{onClick:O,className:"w-full",children:"Mark as Paid"})]}),(0,n.jsxs)("div",{className:"mt-8",children:[(0,n.jsx)("h3",{className:"font-semibold mb-2",children:"Payment History"}),0===p.length?(0,n.jsx)("p",{className:"text-gray-500",children:"No payments recorded yet."}):(0,n.jsx)("ul",{className:"space-y-2",children:p.map(e=>(0,n.jsxs)("li",{className:"flex justify-between items-center",children:[(0,n.jsxs)("span",{children:["$",e.amount.toFixed(2)," via ",e.payment_method,e.client_comment&&(0,n.jsxs)("span",{className:"ml-2 text-xs text-gray-400",children:["(",e.client_comment,")"]})]}),(0,n.jsx)("span",{className:"text-sm text-gray-500",children:(0,x.WU)(new Date(e.payment_date),"MMM dd, yyyy")})]},e.id))})]})]})]}):(0,n.jsx)("div",{className:"text-gray-500",children:"Select an invoice to view details"})})]})]})})}},3277:function(e,t,r){"use strict";r.d(t,{C:function(){return l}});var n=r(3827);r(4090);var s=r(9769),a=r(2169);let i=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:r,...s}=e;return(0,n.jsx)("div",{className:(0,a.cn)(i({variant:r}),t),...s})}},575:function(e,t,r){"use strict";r.d(t,{z:function(){return d}});var n=r(3827),s=r(4090),a=r(9143),i=r(9769),l=r(2169);let o=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,t)=>{let{className:r,variant:s,size:i,asChild:d=!1,...c}=e,u=d?a.g7:"button";return(0,n.jsx)(u,{className:(0,l.cn)(o({variant:s,size:i,className:r})),ref:t,...c})});d.displayName="Button"},5671:function(e,t,r){"use strict";r.d(t,{Ol:function(){return l},SZ:function(){return d},Zb:function(){return i},aY:function(){return c},ll:function(){return o}});var n=r(3827),s=r(4090),a=r(2169);let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});i.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",r),...s})});l.displayName="CardHeader";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("h3",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});o.displayName="CardTitle";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",r),...s})});d.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",r),...s})});c.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter"},2782:function(e,t,r){"use strict";r.d(t,{I:function(){return i}});var n=r(3827),s=r(4090),a=r(2169);let i=s.forwardRef((e,t)=>{let{className:r,type:s,...i}=e;return(0,n.jsx)("input",{type:s,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...i})});i.displayName="Input"},2647:function(e,t,r){"use strict";r.d(t,{_:function(){return d}});var n=r(3827),s=r(4090),a=r(4602),i=r(9769),l=r(2169);let o=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)(a.f,{ref:t,className:(0,l.cn)(o(),r),...s})});d.displayName=a.f.displayName},8685:function(e,t,r){"use strict";r.d(t,{g:function(){return i}});var n=r(3827),s=r(4090),a=r(2169);let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("textarea",{className:(0,a.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...s})});i.displayName="Textarea"},2131:function(e,t,r){"use strict";r.d(t,{H:function(){return o},a:function(){return d}});var n=r(3827),s=r(4090),a=r(9902),i=r(7907);let l=(0,s.createContext)(void 0),o=e=>{let{children:t}=e,[r,o]=(0,s.useState)(null),[d,c]=(0,s.useState)(null),[u,f]=(0,s.useState)(!0),m=(0,i.useRouter)();(0,s.useEffect)(()=>{let{data:{subscription:e}}=a.O.auth.onAuthStateChange((e,t)=>{var r;c(t),o(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null),f(!1)});return a.O.auth.getSession().then(e=>{var t;let{data:{session:r}}=e;c(r),o(null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null),f(!1)}),()=>e.unsubscribe()},[]);let x=async()=>{let{error:e}=await a.O.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/")}});if(e)throw e},h=async(e,t)=>{let{error:r}=await a.O.auth.signInWithPassword({email:e,password:t});return{error:r}},g=async(e,t,r)=>{let{error:n}=await a.O.auth.signUp({email:e,password:t,options:{emailRedirectTo:"".concat(window.location.origin,"/"),data:{full_name:r}}});return{error:n}},p=async()=>{await a.O.auth.signOut(),m.push("/auth")};return(0,n.jsx)(l.Provider,{value:{user:r,session:d,loading:u,signInWithGoogle:x,signInWithEmail:h,signUpWithEmail:g,signOut:p,supabase:a.O},children:t})},d=()=>{let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9902:function(e,t,r){"use strict";r.d(t,{O:function(){return n}});let n=(0,r(3549).eI)("https://bsvctnxiaquebimrxvoo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJzdmN0bnhpYXF1ZWJpbXJ4dm9vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg5NzE1MDEsImV4cCI6MjA2NDU0NzUwMX0._S6ZoYf5H44R5kvHL6I73lHGLJ1YP8P0tMHNOyfkeKU")},2169:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var n=r(3167),s=r(1367);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,n.W)(t))}}},function(e){e.O(0,[360,894,2,971,69,744],function(){return e(e.s=6954)}),_N_E=e.O()}]);