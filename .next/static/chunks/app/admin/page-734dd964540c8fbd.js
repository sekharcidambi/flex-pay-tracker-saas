(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{5424:function(e,t,s){Promise.resolve().then(s.bind(s,7092))},7092:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return _}});var r=s(3827),n=s(4090),a=s(5671),i=s(2169);let l=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:t,className:(0,i.cn)("w-full caption-bottom text-sm",s),...n})})});l.displayName="Table";let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("thead",{ref:t,className:(0,i.cn)("[&_tr]:border-b",s),...n})});d.displayName="TableHeader";let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("tbody",{ref:t,className:(0,i.cn)("[&_tr:last-child]:border-0",s),...n})});c.displayName="TableBody",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("tfoot",{ref:t,className:(0,i.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...n})}).displayName="TableFooter";let o=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("tr",{ref:t,className:(0,i.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...n})});o.displayName="TableRow";let u=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("th",{ref:t,className:(0,i.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...n})});u.displayName="TableHead";let m=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("td",{ref:t,className:(0,i.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...n})});m.displayName="TableCell",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("caption",{ref:t,className:(0,i.cn)("mt-4 text-sm text-muted-foreground",s),...n})}).displayName="TableCaption";var f=s(3277),x=s(2131),h=s(2959),g=s(2782),p=s(2647),b=s(575),v=s(9902),y=s(6288);function j(e){let{onCreated:t}=e,[s,i]=(0,n.useState)({name:"",email:"",phone:"",address:"",website:"",tax_id:"",default_currency:"USD",default_payment_terms:"30 days",invoice_prefix:"INV",admin_user_email:""}),[l,d]=(0,n.useState)(!1),c=e=>{i({...s,[e.target.name]:e.target.value})},o=async e=>{e.preventDefault(),d(!0);try{let{data:e,error:r}=await v.O.from("businesses").insert({name:s.name,email:s.email,phone:s.phone,address:s.address,website:s.website,tax_id:s.tax_id,default_currency:s.default_currency,default_payment_terms:s.default_payment_terms,invoice_prefix:s.invoice_prefix}).select().single();if(r)throw r;let{data:n,error:a}=await v.O.from("profiles").select("id").eq("email",s.admin_user_email).single();if(a)throw Error("Admin user not found");let{error:l}=await v.O.from("business_users").insert({business_id:e.id,user_id:n.id,role:"admin"});if(l)throw l;y.toast.success("Business created and admin linked!"),i({name:"",email:"",phone:"",address:"",website:"",tax_id:"",default_currency:"USD",default_payment_terms:"30 days",invoice_prefix:"INV",admin_user_email:""}),t&&t()}catch(e){y.toast.error(e.message||"Failed to create business")}finally{d(!1)}};return(0,r.jsxs)(a.Zb,{className:"max-w-xl mx-auto mt-8",children:[(0,r.jsx)(a.Ol,{children:(0,r.jsx)(a.ll,{children:"Onboard a New Business"})}),(0,r.jsx)(a.aY,{children:(0,r.jsxs)("form",{onSubmit:o,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p._,{htmlFor:"name",children:"Business Name *"}),(0,r.jsx)(g.I,{id:"name",name:"name",value:s.name,onChange:c,required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p._,{htmlFor:"email",children:"Business Email *"}),(0,r.jsx)(g.I,{id:"email",name:"email",type:"email",value:s.email,onChange:c,required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p._,{htmlFor:"phone",children:"Phone"}),(0,r.jsx)(g.I,{id:"phone",name:"phone",value:s.phone,onChange:c})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p._,{htmlFor:"website",children:"Website"}),(0,r.jsx)(g.I,{id:"website",name:"website",value:s.website,onChange:c})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p._,{htmlFor:"tax_id",children:"Tax ID"}),(0,r.jsx)(g.I,{id:"tax_id",name:"tax_id",value:s.tax_id,onChange:c})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p._,{htmlFor:"invoice_prefix",children:"Invoice Prefix"}),(0,r.jsx)(g.I,{id:"invoice_prefix",name:"invoice_prefix",value:s.invoice_prefix,onChange:c})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p._,{htmlFor:"default_currency",children:"Default Currency"}),(0,r.jsx)(g.I,{id:"default_currency",name:"default_currency",value:s.default_currency,onChange:c})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p._,{htmlFor:"default_payment_terms",children:"Default Payment Terms"}),(0,r.jsx)(g.I,{id:"default_payment_terms",name:"default_payment_terms",value:s.default_payment_terms,onChange:c})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p._,{htmlFor:"admin_user_email",children:"Admin User Email *"}),(0,r.jsx)(g.I,{id:"admin_user_email",name:"admin_user_email",type:"email",value:s.admin_user_email,onChange:c,required:!0})]}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)(b.z,{type:"submit",disabled:l,children:l?"Creating...":"Create Business"})})]})})]})}function _(){let{user:e,supabase:t}=(0,x.a)(),[s,i]=(0,n.useState)([]),[g,p]=(0,n.useState)(!0),[b,v]=(0,n.useState)(!1);(0,n.useEffect)(()=>{e&&t?y():e||(console.log("AdminPage: No user found in useAuth effect."),p(!1))},[e,t]);let y=async()=>{console.log("AdminPage: checkAdminStatus function called.");let{data:{user:e}}=await t.auth.getUser();if(!e){console.log("AdminPage: No current user found via supabase.auth.getUser() before profile fetch."),p(!1);return}console.log("AdminPage: Current user ID confirmed via auth.getUser():",e.id),console.log("AdminPage: Checking admin status for user ID:",e.id);try{let{data:s,error:r}=await t.from("profiles").select("is_system_admin").eq("id",e.id).maybeSingle();if(r){console.error("AdminPage: Error fetching profile:",r),p(!1);return}console.log("AdminPage: Fetched profile data:",s),console.log("AdminPage: is_system_admin value:",null==s?void 0:s.is_system_admin),(null==s?void 0:s.is_system_admin)?(console.log("AdminPage: User is system admin."),v(!0),await _()):(console.log("AdminPage: User is NOT system admin."),p(!1))}catch(e){console.error("AdminPage: Error checking admin status (caught):",e),p(!1)}},_=async()=>{if(t){console.log("AdminPage: fetchBusinessStats function called.");try{let{data:e,error:s}=await t.from("businesses").select("\n          id,\n          name,\n          email,\n          created_at,\n          clients!businesses_business_id_fkey(count),\n          invoices!businesses_business_id_fkey(count, total_amount)\n        ");if(s){console.error("AdminPage: Error fetching business stats:",s),p(!1);return}console.log("AdminPage: Successfully fetched business data.",e);let r=(e||[]).map(e=>{let t=Array.isArray(e.clients)?e.clients.length:0,s=Array.isArray(e.invoices)?e.invoices:[],r=s.length,n=Array.isArray(s)?s.reduce((e,t)=>e+(t.total_amount||0),0):0;return{id:e.id,name:e.name,email:e.email,created_at:e.created_at,client_count:t,invoice_count:r,total_revenue:n}});i(r)}catch(e){console.error("Error fetching business stats:",e)}finally{p(!1)}}};return g?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading admin panel..."})]})}):b?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,r.jsx)(j,{}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"System Admin Panel"}),(0,r.jsx)("p",{className:"text-gray-600 mt-2",children:"Overview of all businesses and their statistics"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,r.jsxs)(a.Zb,{children:[(0,r.jsx)(a.Ol,{className:"pb-3",children:(0,r.jsx)(a.ll,{className:"text-sm font-medium text-gray-600",children:"Total Businesses"})}),(0,r.jsx)(a.aY,{children:(0,r.jsx)("div",{className:"text-3xl font-bold",children:s.length})})]}),(0,r.jsxs)(a.Zb,{children:[(0,r.jsx)(a.Ol,{className:"pb-3",children:(0,r.jsx)(a.ll,{className:"text-sm font-medium text-gray-600",children:"Total Clients"})}),(0,r.jsx)(a.aY,{children:(0,r.jsx)("div",{className:"text-3xl font-bold",children:s.reduce((e,t)=>e+t.client_count,0)})})]}),(0,r.jsxs)(a.Zb,{children:[(0,r.jsx)(a.Ol,{className:"pb-3",children:(0,r.jsx)(a.ll,{className:"text-sm font-medium text-gray-600",children:"Total Invoices"})}),(0,r.jsx)(a.aY,{children:(0,r.jsx)("div",{className:"text-3xl font-bold",children:s.reduce((e,t)=>e+t.invoice_count,0)})})]}),(0,r.jsxs)(a.Zb,{children:[(0,r.jsx)(a.Ol,{className:"pb-3",children:(0,r.jsx)(a.ll,{className:"text-sm font-medium text-gray-600",children:"Total Revenue"})}),(0,r.jsx)(a.aY,{children:(0,r.jsxs)("div",{className:"text-3xl font-bold",children:["$",s.reduce((e,t)=>e+t.total_revenue,0).toFixed(2)]})})]})]}),(0,r.jsxs)(a.Zb,{children:[(0,r.jsx)(a.Ol,{children:(0,r.jsx)(a.ll,{children:"Business Overview"})}),(0,r.jsx)(a.aY,{children:(0,r.jsxs)(l,{children:[(0,r.jsx)(d,{children:(0,r.jsxs)(o,{children:[(0,r.jsx)(u,{children:"Business Name"}),(0,r.jsx)(u,{children:"Email"}),(0,r.jsx)(u,{children:"Created"}),(0,r.jsx)(u,{className:"text-center",children:"Clients"}),(0,r.jsx)(u,{className:"text-center",children:"Invoices"}),(0,r.jsx)(u,{className:"text-right",children:"Revenue"})]})}),(0,r.jsx)(c,{children:s.map(e=>(0,r.jsxs)(o,{children:[(0,r.jsx)(m,{className:"font-medium",children:e.name}),(0,r.jsx)(m,{children:e.email}),(0,r.jsx)(m,{children:(0,h.WU)(new Date(e.created_at),"MMM dd, yyyy")}),(0,r.jsx)(m,{className:"text-center",children:(0,r.jsx)(f.C,{variant:"secondary",children:e.client_count})}),(0,r.jsx)(m,{className:"text-center",children:(0,r.jsx)(f.C,{variant:"secondary",children:e.invoice_count})}),(0,r.jsxs)(m,{className:"text-right",children:["$",e.total_revenue.toFixed(2)]})]},e.id))})]})})]})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)(a.Zb,{className:"w-full max-w-md",children:[(0,r.jsx)(a.Ol,{children:(0,r.jsx)(a.ll,{className:"text-center text-red-600",children:"Access Denied"})}),(0,r.jsx)(a.aY,{children:(0,r.jsx)("p",{className:"text-center text-gray-600",children:"You don't have permission to access the admin panel."})})]})})}},3277:function(e,t,s){"use strict";s.d(t,{C:function(){return l}});var r=s(3827);s(4090);var n=s(9769),a=s(2169);let i=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:s,...n}=e;return(0,r.jsx)("div",{className:(0,a.cn)(i({variant:s}),t),...n})}},575:function(e,t,s){"use strict";s.d(t,{z:function(){return c}});var r=s(3827),n=s(4090),a=s(9143),i=s(9769),l=s(2169);let d=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef((e,t)=>{let{className:s,variant:n,size:i,asChild:c=!1,...o}=e,u=c?a.g7:"button";return(0,r.jsx)(u,{className:(0,l.cn)(d({variant:n,size:i,className:s})),ref:t,...o})});c.displayName="Button"},5671:function(e,t,s){"use strict";s.d(t,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return i},aY:function(){return o},ll:function(){return d}});var r=s(3827),n=s(4090),a=s(2169);let i=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...n})});i.displayName="Card";let l=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",s),...n})});l.displayName="CardHeader";let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("h3",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",s),...n})});d.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",s),...n})});c.displayName="CardDescription";let o=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",s),...n})});o.displayName="CardContent",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",s),...n})}).displayName="CardFooter"},2782:function(e,t,s){"use strict";s.d(t,{I:function(){return i}});var r=s(3827),n=s(4090),a=s(2169);let i=n.forwardRef((e,t)=>{let{className:s,type:n,...i}=e;return(0,r.jsx)("input",{type:n,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...i})});i.displayName="Input"},2647:function(e,t,s){"use strict";s.d(t,{_:function(){return c}});var r=s(3827),n=s(4090),a=s(4602),i=s(9769),l=s(2169);let d=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(a.f,{ref:t,className:(0,l.cn)(d(),s),...n})});c.displayName=a.f.displayName},2131:function(e,t,s){"use strict";s.d(t,{H:function(){return d},a:function(){return c}});var r=s(3827),n=s(4090),a=s(9902),i=s(7907);let l=(0,n.createContext)(void 0),d=e=>{let{children:t}=e,[s,d]=(0,n.useState)(null),[c,o]=(0,n.useState)(null),[u,m]=(0,n.useState)(!0),f=(0,i.useRouter)();(0,n.useEffect)(()=>{let{data:{subscription:e}}=a.O.auth.onAuthStateChange((e,t)=>{var s;o(t),d(null!==(s=null==t?void 0:t.user)&&void 0!==s?s:null),m(!1)});return a.O.auth.getSession().then(e=>{var t;let{data:{session:s}}=e;o(s),d(null!==(t=null==s?void 0:s.user)&&void 0!==t?t:null),m(!1)}),()=>e.unsubscribe()},[]);let x=async()=>{let{error:e}=await a.O.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/")}});if(e)throw e},h=async(e,t)=>{let{error:s}=await a.O.auth.signInWithPassword({email:e,password:t});return{error:s}},g=async(e,t,s)=>{let{error:r}=await a.O.auth.signUp({email:e,password:t,options:{emailRedirectTo:"".concat(window.location.origin,"/"),data:{full_name:s}}});return{error:r}},p=async()=>{await a.O.auth.signOut(),f.push("/auth")};return(0,r.jsx)(l.Provider,{value:{user:s,session:c,loading:u,signInWithGoogle:x,signInWithEmail:h,signUpWithEmail:g,signOut:p,supabase:a.O},children:t})},c=()=>{let e=(0,n.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9902:function(e,t,s){"use strict";s.d(t,{O:function(){return r}});let r=(0,s(3549).eI)("https://bsvctnxiaquebimrxvoo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJzdmN0bnhpYXF1ZWJpbXJ4dm9vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg5NzE1MDEsImV4cCI6MjA2NDU0NzUwMX0._S6ZoYf5H44R5kvHL6I73lHGLJ1YP8P0tMHNOyfkeKU")},2169:function(e,t,s){"use strict";s.d(t,{cn:function(){return a}});var r=s(3167),n=s(1367);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,n.m6)((0,r.W)(t))}}},function(e){e.O(0,[360,894,2,971,69,744],function(){return e(e.s=5424)}),_N_E=e.O()}]);