(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{5424:function(e,t,r){Promise.resolve().then(r.bind(r,4928))},4928:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return j}});var s=r(3827),n=r(4090),a=r(5671),l=r(2169);let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:t,className:(0,l.cn)("w-full caption-bottom text-sm",r),...n})})});i.displayName="Table";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("thead",{ref:t,className:(0,l.cn)("[&_tr]:border-b",r),...n})});c.displayName="TableHeader";let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("tbody",{ref:t,className:(0,l.cn)("[&_tr:last-child]:border-0",r),...n})});d.displayName="TableBody",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("tfoot",{ref:t,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...n})}).displayName="TableFooter";let o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("tr",{ref:t,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...n})});o.displayName="TableRow";let u=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("th",{ref:t,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...n})});u.displayName="TableHead";let m=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("td",{ref:t,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...n})});m.displayName="TableCell",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("caption",{ref:t,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",r),...n})}).displayName="TableCaption";var x=r(3277),f=r(9902),h=r(2131),b=r(2959);function j(){let{user:e}=(0,h.a)(),[t,r]=(0,n.useState)([]),[l,j]=(0,n.useState)(!0),[v,N]=(0,n.useState)(!1);(0,n.useEffect)(()=>{y()},[e]);let y=async()=>{if(e)try{let{data:t,error:r}=await f.O.from("profiles").select("is_system_admin").eq("id",e.id).single();if(r)throw r;(null==t?void 0:t.is_system_admin)?(N(!0),await g()):j(!1)}catch(e){console.error("Error checking admin status:",e),j(!1)}},g=async()=>{try{let{data:e,error:t}=await f.O.from("businesses").select("\n          id,\n          name,\n          email,\n          created_at,\n          clients!businesses_business_id_fkey(count),\n          invoices!businesses_business_id_fkey(count, total_amount)\n        ");if(t)throw t;let s=(e||[]).map(e=>{let t=Array.isArray(e.clients)?e.clients.length:0,r=Array.isArray(e.invoices)?e.invoices:[],s=r.length,n=Array.isArray(r)?r.reduce((e,t)=>e+(t.total_amount||0),0):0;return{id:e.id,name:e.name,email:e.email,created_at:e.created_at,client_count:t,invoice_count:s,total_revenue:n}});r(s)}catch(e){console.error("Error fetching business stats:",e)}finally{j(!1)}};return l?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading admin panel..."})]})}):v?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"System Admin Panel"}),(0,s.jsx)("p",{className:"text-gray-600 mt-2",children:"Overview of all businesses and their statistics"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,s.jsxs)(a.Zb,{children:[(0,s.jsx)(a.Ol,{className:"pb-3",children:(0,s.jsx)(a.ll,{className:"text-sm font-medium text-gray-600",children:"Total Businesses"})}),(0,s.jsx)(a.aY,{children:(0,s.jsx)("div",{className:"text-3xl font-bold",children:t.length})})]}),(0,s.jsxs)(a.Zb,{children:[(0,s.jsx)(a.Ol,{className:"pb-3",children:(0,s.jsx)(a.ll,{className:"text-sm font-medium text-gray-600",children:"Total Clients"})}),(0,s.jsx)(a.aY,{children:(0,s.jsx)("div",{className:"text-3xl font-bold",children:t.reduce((e,t)=>e+t.client_count,0)})})]}),(0,s.jsxs)(a.Zb,{children:[(0,s.jsx)(a.Ol,{className:"pb-3",children:(0,s.jsx)(a.ll,{className:"text-sm font-medium text-gray-600",children:"Total Invoices"})}),(0,s.jsx)(a.aY,{children:(0,s.jsx)("div",{className:"text-3xl font-bold",children:t.reduce((e,t)=>e+t.invoice_count,0)})})]}),(0,s.jsxs)(a.Zb,{children:[(0,s.jsx)(a.Ol,{className:"pb-3",children:(0,s.jsx)(a.ll,{className:"text-sm font-medium text-gray-600",children:"Total Revenue"})}),(0,s.jsx)(a.aY,{children:(0,s.jsxs)("div",{className:"text-3xl font-bold",children:["$",t.reduce((e,t)=>e+t.total_revenue,0).toFixed(2)]})})]})]}),(0,s.jsxs)(a.Zb,{children:[(0,s.jsx)(a.Ol,{children:(0,s.jsx)(a.ll,{children:"Business Overview"})}),(0,s.jsx)(a.aY,{children:(0,s.jsxs)(i,{children:[(0,s.jsx)(c,{children:(0,s.jsxs)(o,{children:[(0,s.jsx)(u,{children:"Business Name"}),(0,s.jsx)(u,{children:"Email"}),(0,s.jsx)(u,{children:"Created"}),(0,s.jsx)(u,{className:"text-center",children:"Clients"}),(0,s.jsx)(u,{className:"text-center",children:"Invoices"}),(0,s.jsx)(u,{className:"text-right",children:"Revenue"})]})}),(0,s.jsx)(d,{children:t.map(e=>(0,s.jsxs)(o,{children:[(0,s.jsx)(m,{className:"font-medium",children:e.name}),(0,s.jsx)(m,{children:e.email}),(0,s.jsx)(m,{children:(0,b.WU)(new Date(e.created_at),"MMM dd, yyyy")}),(0,s.jsx)(m,{className:"text-center",children:(0,s.jsx)(x.C,{variant:"secondary",children:e.client_count})}),(0,s.jsx)(m,{className:"text-center",children:(0,s.jsx)(x.C,{variant:"secondary",children:e.invoice_count})}),(0,s.jsxs)(m,{className:"text-right",children:["$",e.total_revenue.toFixed(2)]})]},e.id))})]})})]})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)(a.Zb,{className:"w-full max-w-md",children:[(0,s.jsx)(a.Ol,{children:(0,s.jsx)(a.ll,{className:"text-center text-red-600",children:"Access Denied"})}),(0,s.jsx)(a.aY,{children:(0,s.jsx)("p",{className:"text-center text-gray-600",children:"You don't have permission to access the admin panel."})})]})})}},3277:function(e,t,r){"use strict";r.d(t,{C:function(){return i}});var s=r(3827);r(4090);var n=r(9769),a=r(2169);let l=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:r,...n}=e;return(0,s.jsx)("div",{className:(0,a.cn)(l({variant:r}),t),...n})}},5671:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},SZ:function(){return d},Zb:function(){return l},aY:function(){return o},ll:function(){return c}});var s=r(3827),n=r(4090),a=r(2169);let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...n})});l.displayName="Card";let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",r),...n})});i.displayName="CardHeader";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("h3",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",r),...n})});c.displayName="CardTitle";let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",r),...n})});d.displayName="CardDescription";let o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",r),...n})});o.displayName="CardContent",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",r),...n})}).displayName="CardFooter"},2131:function(e,t,r){"use strict";r.d(t,{H:function(){return i},a:function(){return c}});var s=r(3827),n=r(4090),a=r(9902);let l=(0,n.createContext)(void 0),i=e=>{let{children:t}=e,[r,i]=(0,n.useState)(null),[c,d]=(0,n.useState)(null),[o,u]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let{data:{subscription:e}}=a.O.auth.onAuthStateChange((e,t)=>{var r;d(t),i(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null),u(!1)});return a.O.auth.getSession().then(e=>{var t;let{data:{session:r}}=e;d(r),i(null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null),u(!1)}),()=>e.unsubscribe()},[]);let m=async()=>{let{error:e}=await a.O.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/")}});if(e)throw e},x=async(e,t)=>{let{error:r}=await a.O.auth.signInWithPassword({email:e,password:t});return{error:r}},f=async(e,t,r)=>{let{error:s}=await a.O.auth.signUp({email:e,password:t,options:{emailRedirectTo:"".concat(window.location.origin,"/"),data:{full_name:r}}});return{error:s}},h=async()=>{await a.O.auth.signOut()};return(0,s.jsx)(l.Provider,{value:{user:r,session:c,loading:o,signInWithGoogle:m,signInWithEmail:x,signUpWithEmail:f,signOut:h},children:t})},c=()=>{let e=(0,n.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9902:function(e,t,r){"use strict";r.d(t,{O:function(){return s}});let s=(0,r(3549).eI)("https://bsvctnxiaquebimrxvoo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJzdmN0bnhpYXF1ZWJpbXJ4dm9vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg5NzE1MDEsImV4cCI6MjA2NDU0NzUwMX0._S6ZoYf5H44R5kvHL6I73lHGLJ1YP8P0tMHNOyfkeKU")},2169:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var s=r(3167),n=r(1367);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,s.W)(t))}}},function(e){e.O(0,[549,504,959,971,69,744],function(){return e(e.s=5424)}),_N_E=e.O()}]);