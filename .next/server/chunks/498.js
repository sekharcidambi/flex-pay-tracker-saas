"use strict";exports.id=498,exports.ids=[498],exports.modules={7498:(e,s,t)=>{t.d(s,{R:()=>N});var a=t(5344),i=t(3729),r=t(3673),n=t(5094),l=t(6540),d=t(9591),c=t(1838),o=t(8765);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let m=(0,t(7075).Z)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var u=t(6327),x=t(8271),f=t(7361),p=t(2690),h=t(8157),v=t(594),y=t(3061),g=t(4755);let j=({invoice:e,onSave:s,onCancel:t})=>{let{currentBusiness:d}=(0,y.i)(),[o,m]=(0,i.useState)([]),[u,j]=(0,i.useState)({client_id:e?.client_id||"",title:e?.title||"",description:e?.description||"",due_date:e?.due_date||"",issue_date:e?.issue_date||new Date().toISOString().split("T")[0],payment_terms:e?.payment_terms||"30 days",currency:e?.currency||"USD",status:e?.status||"draft",notes:e?.notes||"",items:e?.items||[{description:"",quantity:1,rate:0,amount:0}]}),[b,N]=(0,i.useState)(!1);(0,i.useEffect)(()=>{w()},[d]);let w=async()=>{if(d)try{let{data:e,error:s}=await v.O.from("clients").select("id, name, email, company").eq("business_id",d.id).order("name");if(s)throw s;m(e||[])}catch(e){console.error("Error fetching clients:",e)}},_=(e,s)=>e*s,C=()=>u.items.reduce((e,s)=>e+s.amount,0),k=(e,s,t)=>{let a=[...u.items];a[e]={...a[e],[s]:t},("quantity"===s||"rate"===s)&&(a[e].amount=_(a[e].quantity,a[e].rate)),j({...u,items:a})},z=e=>{if(u.items.length>1){let s=u.items.filter((s,t)=>t!==e);j({...u,items:s})}},I=async t=>{if(t.preventDefault(),d){N(!0);try{let t=C();if(e?.id){let{error:s}=await v.O.from("invoices").update({client_id:u.client_id,title:u.title,description:u.description,due_date:u.due_date,issue_date:u.issue_date,payment_terms:u.payment_terms,currency:u.currency,status:u.status,notes:u.notes,amount:t,total_amount:t}).eq("id",e.id);if(s)throw s;await v.O.from("invoice_items").delete().eq("invoice_id",e.id);let{error:a}=await v.O.from("invoice_items").insert(u.items.map(s=>({invoice_id:e.id,description:s.description,quantity:s.quantity,rate:s.rate,amount:s.amount})));if(a)throw a;g.toast.success("Invoice updated successfully")}else{let{data:e,error:s}=await v.O.rpc("generate_invoice_number");if(s)throw s;let{data:a,error:i}=await v.O.from("invoices").insert({invoice_number:e,business_id:d.id,freelancer_id:d.id,client_id:u.client_id,title:u.title,description:u.description,due_date:u.due_date,issue_date:u.issue_date,payment_terms:u.payment_terms,currency:u.currency,status:u.status,notes:u.notes,amount:t,total_amount:t}).select().single();if(i)throw i;let{error:r}=await v.O.from("invoice_items").insert(u.items.map(e=>({invoice_id:a.id,description:e.description,quantity:e.quantity,rate:e.rate,amount:e.amount})));if(r)throw r;g.toast.success("Invoice created successfully")}s()}catch(e){g.toast.error(e.message||"Failed to save invoice")}finally{N(!1)}}};return(0,a.jsxs)(r.Zb,{children:[a.jsx(r.Ol,{children:a.jsx(r.ll,{children:e?"Edit Invoice":"Create New Invoice"})}),a.jsx(r.aY,{children:(0,a.jsxs)("form",{onSubmit:I,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(f._,{htmlFor:"client",children:"Client *"}),(0,a.jsxs)(h.Ph,{value:u.client_id,onValueChange:e=>j({...u,client_id:e}),children:[a.jsx(h.i4,{children:a.jsx(h.ki,{placeholder:"Select a client"})}),a.jsx(h.Bw,{children:o.map(e=>(0,a.jsxs)(h.Ql,{value:e.id,children:[e.name," ",e.company&&`(${e.company})`]},e.id))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(f._,{htmlFor:"title",children:"Title *"}),a.jsx(l.I,{id:"title",value:u.title,onChange:e=>j({...u,title:e.target.value}),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(f._,{htmlFor:"issue_date",children:"Issue Date"}),a.jsx(l.I,{id:"issue_date",type:"date",value:u.issue_date,onChange:e=>j({...u,issue_date:e.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(f._,{htmlFor:"due_date",children:"Due Date"}),a.jsx(l.I,{id:"due_date",type:"date",value:u.due_date,onChange:e=>j({...u,due_date:e.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(f._,{htmlFor:"payment_terms",children:"Payment Terms"}),(0,a.jsxs)(h.Ph,{value:u.payment_terms,onValueChange:e=>j({...u,payment_terms:e}),children:[a.jsx(h.i4,{children:a.jsx(h.ki,{})}),(0,a.jsxs)(h.Bw,{children:[a.jsx(h.Ql,{value:"Due on receipt",children:"Due on receipt"}),a.jsx(h.Ql,{value:"15 days",children:"15 days"}),a.jsx(h.Ql,{value:"30 days",children:"30 days"}),a.jsx(h.Ql,{value:"60 days",children:"60 days"}),a.jsx(h.Ql,{value:"90 days",children:"90 days"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(f._,{htmlFor:"currency",children:"Currency"}),(0,a.jsxs)(h.Ph,{value:u.currency,onValueChange:e=>j({...u,currency:e}),children:[a.jsx(h.i4,{children:a.jsx(h.ki,{})}),(0,a.jsxs)(h.Bw,{children:[a.jsx(h.Ql,{value:"USD",children:"USD"}),a.jsx(h.Ql,{value:"EUR",children:"EUR"}),a.jsx(h.Ql,{value:"GBP",children:"GBP"}),a.jsx(h.Ql,{value:"CAD",children:"CAD"})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(f._,{htmlFor:"description",children:"Description"}),a.jsx(p.g,{id:"description",value:u.description,onChange:e=>j({...u,description:e.target.value}),rows:3})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx(f._,{children:"Invoice Items"}),(0,a.jsxs)(n.z,{type:"button",onClick:()=>{j({...u,items:[...u.items,{description:"",quantity:1,rate:0,amount:0}]})},size:"sm",children:[a.jsx(c.Z,{className:"w-4 h-4 mr-2"}),"Add Item"]})]}),a.jsx("div",{className:"space-y-2",children:u.items.map((e,s)=>(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-end",children:[a.jsx("div",{className:"col-span-5",children:a.jsx(l.I,{placeholder:"Description",value:e.description,onChange:e=>k(s,"description",e.target.value)})}),a.jsx("div",{className:"col-span-2",children:a.jsx(l.I,{placeholder:"Qty",type:"number",min:"0",step:"0.01",value:e.quantity,onChange:e=>k(s,"quantity",parseFloat(e.target.value)||0)})}),a.jsx("div",{className:"col-span-2",children:a.jsx(l.I,{placeholder:"Rate",type:"number",min:"0",step:"0.01",value:e.rate,onChange:e=>k(s,"rate",parseFloat(e.target.value)||0)})}),a.jsx("div",{className:"col-span-2",children:a.jsx(l.I,{value:e.amount.toFixed(2),readOnly:!0,className:"bg-gray-50"})}),a.jsx("div",{className:"col-span-1",children:a.jsx(n.z,{type:"button",variant:"outline",size:"sm",onClick:()=>z(s),disabled:1===u.items.length,children:a.jsx(x.Z,{className:"w-4 h-4"})})})]},s))}),a.jsx("div",{className:"text-right",children:(0,a.jsxs)("div",{className:"text-lg font-semibold",children:["Total: ",u.currency," ",C().toFixed(2)]})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(f._,{htmlFor:"notes",children:"Notes"}),a.jsx(p.g,{id:"notes",value:u.notes,onChange:e=>j({...u,notes:e.target.value}),rows:3})]}),(0,a.jsxs)("div",{className:"flex gap-2 justify-end",children:[a.jsx(n.z,{type:"button",variant:"outline",onClick:t,children:"Cancel"}),a.jsx(n.z,{type:"submit",disabled:b,children:b?"Saving...":"Save Invoice"})]})]})})]})};var b=t(2400);let N=()=>{let{currentBusiness:e}=(0,y.i)(),[s,t]=(0,i.useState)(""),[f,p]=(0,i.useState)([]),[h,N]=(0,i.useState)(!0),[w,_]=(0,i.useState)(!1),[C,k]=(0,i.useState)();(0,i.useEffect)(()=>{e&&z()},[e]);let z=async()=>{if(e)try{let{data:s,error:t}=await v.O.from("invoices").select(`
          *,
          clients (
            name,
            company
          )
        `).eq("business_id",e.id).order("created_at",{ascending:!1});if(t)throw t;p(s||[])}catch(e){console.error("Error fetching invoices:",e),g.toast.error("Failed to fetch invoices")}finally{N(!1)}},I=async e=>{try{let{data:s,error:t}=await v.O.from("invoice_items").select("*").eq("invoice_id",e.id);if(t)throw t;k({...e,items:s||[]}),_(!0)}catch(e){g.toast.error(e.message||"Failed to load invoice details")}},R=async e=>{if(confirm("Are you sure you want to delete this invoice?"))try{let{error:s}=await v.O.from("invoices").delete().eq("id",e);if(s)throw s;g.toast.success("Invoice deleted successfully"),z()}catch(e){g.toast.error(e.message||"Failed to delete invoice")}},S=e=>{switch(e){case"paid":return"bg-green-100 text-green-800";case"overdue":return"bg-red-100 text-red-800";case"sent":return"bg-blue-100 text-blue-800";case"viewed":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},F=f.filter(e=>e.invoice_number.toLowerCase().includes(s.toLowerCase())||e.title.toLowerCase().includes(s.toLowerCase())||e.clients.name.toLowerCase().includes(s.toLowerCase()));return e?w?a.jsx("div",{className:"space-y-6",children:a.jsx(j,{invoice:C,onSave:()=>{_(!1),k(void 0),z()},onCancel:()=>{_(!1),k(void 0)}})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Invoices"}),a.jsx("p",{className:"text-gray-600 mt-1",children:"Create and manage your invoices."})]}),(0,a.jsxs)(n.z,{onClick:()=>_(!0),className:"bg-blue-600 hover:bg-blue-700",children:[a.jsx(c.Z,{className:"w-4 h-4 mr-2"}),"Create Invoice"]})]}),(0,a.jsxs)(r.Zb,{className:"p-6",children:[a.jsx("div",{className:"flex items-center gap-4 mb-6",children:(0,a.jsxs)("div",{className:"relative flex-1 max-w-md",children:[a.jsx(o.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),a.jsx(l.I,{placeholder:"Search invoices...",value:s,onChange:e=>t(e.target.value),className:"pl-10"})]})}),h?(0,a.jsxs)("div",{className:"text-center py-8",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),a.jsx("p",{className:"mt-2 text-gray-600",children:"Loading invoices..."})]}):0===F.length?a.jsx("div",{className:"text-center py-8",children:a.jsx("p",{className:"text-gray-600",children:"No invoices found."})}):a.jsx("div",{className:"space-y-4",children:F.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[a.jsx("div",{className:"flex items-center gap-4",children:(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:e.invoice_number}),a.jsx("p",{className:"text-sm text-gray-600",children:e.title}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[e.clients.name," ",e.clients.company&&`(${e.clients.company})`]})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-medium text-gray-900",children:[e.currency," ",e.total_amount.toFixed(2)]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Due: ",(0,b.WU)(new Date(e.due_date),"MMM dd, yyyy")]})]}),a.jsx(d.C,{className:S(e.status),children:e.status}),(0,a.jsxs)("div",{className:"flex gap-1",children:[a.jsx(n.z,{variant:"ghost",size:"sm",children:a.jsx(m,{className:"w-4 h-4"})}),a.jsx(n.z,{variant:"ghost",size:"sm",onClick:()=>I(e),children:a.jsx(u.Z,{className:"w-4 h-4"})}),a.jsx(n.z,{variant:"ghost",size:"sm",onClick:()=>R(e.id),children:a.jsx(x.Z,{className:"w-4 h-4 text-red-500"})})]})]})]},e.id))})]})]}):a.jsx("div",{children:"Loading..."})}},9591:(e,s,t)=>{t.d(s,{C:()=>l});var a=t(5344);t(3729);var i=t(9247),r=t(1453);let n=(0,i.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l({className:e,variant:s,...t}){return a.jsx("div",{className:(0,r.cn)(n({variant:s}),e),...t})}},5094:(e,s,t)=>{t.d(s,{z:()=>c});var a=t(5344),i=t(3729),r=t(2751),n=t(9247),l=t(1453);let d=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=i.forwardRef(({className:e,variant:s,size:t,asChild:i=!1,...n},c)=>{let o=i?r.g7:"button";return a.jsx(o,{className:(0,l.cn)(d({variant:s,size:t,className:e})),ref:c,...n})});c.displayName="Button"},3673:(e,s,t)=>{t.d(s,{Ol:()=>l,SZ:()=>c,Zb:()=>n,aY:()=>o,ll:()=>d});var a=t(5344),i=t(3729),r=t(1453);let n=i.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));n.displayName="Card";let l=i.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",e),...s}));l.displayName="CardHeader";let d=i.forwardRef(({className:e,...s},t)=>a.jsx("h3",{ref:t,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",e),...s}));d.displayName="CardTitle";let c=i.forwardRef(({className:e,...s},t)=>a.jsx("p",{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",e),...s}));c.displayName="CardDescription";let o=i.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,className:(0,r.cn)("p-6 pt-0",e),...s}));o.displayName="CardContent",i.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,className:(0,r.cn)("flex items-center p-6 pt-0",e),...s})).displayName="CardFooter"},6540:(e,s,t)=>{t.d(s,{I:()=>n});var a=t(5344),i=t(3729),r=t(1453);let n=i.forwardRef(({className:e,type:s,...t},i)=>a.jsx("input",{type:s,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:i,...t}));n.displayName="Input"},7361:(e,s,t)=>{t.d(s,{_:()=>c});var a=t(5344),i=t(3729),r=t(4217),n=t(9247),l=t(1453);let d=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=i.forwardRef(({className:e,...s},t)=>a.jsx(r.f,{ref:t,className:(0,l.cn)(d(),e),...s}));c.displayName=r.f.displayName},8157:(e,s,t)=>{t.d(s,{Bw:()=>p,Ph:()=>o,Ql:()=>h,i4:()=>u,ki:()=>m});var a=t(5344),i=t(3729),r=t(3646),n=t(5390),l=t(2704),d=t(2312),c=t(1453);let o=r.fC;r.ZA;let m=r.B4,u=i.forwardRef(({className:e,children:s,...t},i)=>(0,a.jsxs)(r.xz,{ref:i,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...t,children:[s,a.jsx(r.JO,{asChild:!0,children:a.jsx(n.Z,{className:"h-4 w-4 opacity-50"})})]}));u.displayName=r.xz.displayName;let x=i.forwardRef(({className:e,...s},t)=>a.jsx(r.u_,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",e),...s,children:a.jsx(l.Z,{className:"h-4 w-4"})}));x.displayName=r.u_.displayName;let f=i.forwardRef(({className:e,...s},t)=>a.jsx(r.$G,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",e),...s,children:a.jsx(n.Z,{className:"h-4 w-4"})}));f.displayName=r.$G.displayName;let p=i.forwardRef(({className:e,children:s,position:t="popper",...i},n)=>a.jsx(r.h_,{children:(0,a.jsxs)(r.VY,{ref:n,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===t&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:t,...i,children:[a.jsx(x,{}),a.jsx(r.l_,{className:(0,c.cn)("p-1","popper"===t&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),a.jsx(f,{})]})}));p.displayName=r.VY.displayName,i.forwardRef(({className:e,...s},t)=>a.jsx(r.__,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...s})).displayName=r.__.displayName;let h=i.forwardRef(({className:e,children:s,...t},i)=>(0,a.jsxs)(r.ck,{ref:i,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...t,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(r.wU,{children:a.jsx(d.Z,{className:"h-4 w-4"})})}),a.jsx(r.eT,{children:s})]}));h.displayName=r.ck.displayName,i.forwardRef(({className:e,...s},t)=>a.jsx(r.Z0,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",e),...s})).displayName=r.Z0.displayName},2690:(e,s,t)=>{t.d(s,{g:()=>n});var a=t(5344),i=t(3729),r=t(1453);let n=i.forwardRef(({className:e,...s},t)=>a.jsx("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:t,...s}));n.displayName="Textarea"}};