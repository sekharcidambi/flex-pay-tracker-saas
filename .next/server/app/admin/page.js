(()=>{var e={};e.id=3,e.ids=[3],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},9190:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>o,routeModule:()=>x,tree:()=>c});var a=r(482),t=r(9108),i=r(2563),n=r.n(i),l=r(8300),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);r.d(s,d);let c=["",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,5557)),"/Users/sekharcidambi/flex-pay-tracker-saas/src/app/admin/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,3625)),"/Users/sekharcidambi/flex-pay-tracker-saas/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,8206)),"/Users/sekharcidambi/flex-pay-tracker-saas/src/app/not-found.tsx"]}],o=["/Users/sekharcidambi/flex-pay-tracker-saas/src/app/admin/page.tsx"],m="/admin/page",u={require:r,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:t.x.APP_PAGE,page:"/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1144:(e,s,r)=>{Promise.resolve().then(r.bind(r,2040))},2040:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>_});var a=r(5344),t=r(3729),i=r(3673),n=r(1453);let l=t.forwardRef(({className:e,...s},r)=>a.jsx("div",{className:"relative w-full overflow-auto",children:a.jsx("table",{ref:r,className:(0,n.cn)("w-full caption-bottom text-sm",e),...s})}));l.displayName="Table";let d=t.forwardRef(({className:e,...s},r)=>a.jsx("thead",{ref:r,className:(0,n.cn)("[&_tr]:border-b",e),...s}));d.displayName="TableHeader";let c=t.forwardRef(({className:e,...s},r)=>a.jsx("tbody",{ref:r,className:(0,n.cn)("[&_tr:last-child]:border-0",e),...s}));c.displayName="TableBody",t.forwardRef(({className:e,...s},r)=>a.jsx("tfoot",{ref:r,className:(0,n.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...s})).displayName="TableFooter";let o=t.forwardRef(({className:e,...s},r)=>a.jsx("tr",{ref:r,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...s}));o.displayName="TableRow";let m=t.forwardRef(({className:e,...s},r)=>a.jsx("th",{ref:r,className:(0,n.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...s}));m.displayName="TableHead";let u=t.forwardRef(({className:e,...s},r)=>a.jsx("td",{ref:r,className:(0,n.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...s}));u.displayName="TableCell",t.forwardRef(({className:e,...s},r)=>a.jsx("caption",{ref:r,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",e),...s})).displayName="TableCaption";var x=r(9591),f=r(853),h=r(2400),p=r(6540),g=r(7361),b=r(5094),y=r(594),v=r(4755);function j({onCreated:e}){let[s,r]=(0,t.useState)({name:"",email:"",phone:"",address:"",website:"",tax_id:"",default_currency:"USD",default_payment_terms:"30 days",invoice_prefix:"INV",admin_user_email:""}),[n,l]=(0,t.useState)(!1),d=e=>{r({...s,[e.target.name]:e.target.value})},c=async a=>{a.preventDefault(),l(!0);try{let{data:a,error:t}=await y.O.from("businesses").insert({name:s.name,email:s.email,phone:s.phone,address:s.address,website:s.website,tax_id:s.tax_id,default_currency:s.default_currency,default_payment_terms:s.default_payment_terms,invoice_prefix:s.invoice_prefix}).select().single();if(t)throw t;let{data:i,error:n}=await y.O.from("profiles").select("id").eq("email",s.admin_user_email).single();if(n)throw Error("Admin user not found");let{error:l}=await y.O.from("business_users").insert({business_id:a.id,user_id:i.id,role:"admin"});if(l)throw l;v.toast.success("Business created and admin linked!"),r({name:"",email:"",phone:"",address:"",website:"",tax_id:"",default_currency:"USD",default_payment_terms:"30 days",invoice_prefix:"INV",admin_user_email:""}),e&&e()}catch(e){v.toast.error(e.message||"Failed to create business")}finally{l(!1)}};return(0,a.jsxs)(i.Zb,{className:"max-w-xl mx-auto mt-8",children:[a.jsx(i.Ol,{children:a.jsx(i.ll,{children:"Onboard a New Business"})}),a.jsx(i.aY,{children:(0,a.jsxs)("form",{onSubmit:c,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(g._,{htmlFor:"name",children:"Business Name *"}),a.jsx(p.I,{id:"name",name:"name",value:s.name,onChange:d,required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(g._,{htmlFor:"email",children:"Business Email *"}),a.jsx(p.I,{id:"email",name:"email",type:"email",value:s.email,onChange:d,required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(g._,{htmlFor:"phone",children:"Phone"}),a.jsx(p.I,{id:"phone",name:"phone",value:s.phone,onChange:d})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(g._,{htmlFor:"website",children:"Website"}),a.jsx(p.I,{id:"website",name:"website",value:s.website,onChange:d})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(g._,{htmlFor:"tax_id",children:"Tax ID"}),a.jsx(p.I,{id:"tax_id",name:"tax_id",value:s.tax_id,onChange:d})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(g._,{htmlFor:"invoice_prefix",children:"Invoice Prefix"}),a.jsx(p.I,{id:"invoice_prefix",name:"invoice_prefix",value:s.invoice_prefix,onChange:d})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(g._,{htmlFor:"default_currency",children:"Default Currency"}),a.jsx(p.I,{id:"default_currency",name:"default_currency",value:s.default_currency,onChange:d})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(g._,{htmlFor:"default_payment_terms",children:"Default Payment Terms"}),a.jsx(p.I,{id:"default_payment_terms",name:"default_payment_terms",value:s.default_payment_terms,onChange:d})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(g._,{htmlFor:"admin_user_email",children:"Admin User Email *"}),a.jsx(p.I,{id:"admin_user_email",name:"admin_user_email",type:"email",value:s.admin_user_email,onChange:d,required:!0})]}),a.jsx("div",{className:"flex justify-end",children:a.jsx(b.z,{type:"submit",disabled:n,children:n?"Creating...":"Create Business"})})]})})]})}function _(){let{user:e,supabase:s}=(0,f.a)(),[r,n]=(0,t.useState)([]),[p,g]=(0,t.useState)(!0),[b,y]=(0,t.useState)(!1);(0,t.useEffect)(()=>{e&&s?v():e||(console.log("AdminPage: No user found in useAuth effect."),g(!1))},[e,s]);let v=async()=>{console.log("AdminPage: checkAdminStatus function called.");let{data:{user:e}}=await s.auth.getUser();if(!e){console.log("AdminPage: No current user found via supabase.auth.getUser() before profile fetch."),g(!1);return}console.log("AdminPage: Current user ID confirmed via auth.getUser():",e.id),console.log("AdminPage: Checking admin status for user ID:",e.id);try{let{data:r,error:a}=await s.from("profiles").select("is_system_admin").eq("id",e.id).maybeSingle();if(a){console.error("AdminPage: Error fetching profile:",a),g(!1);return}console.log("AdminPage: Fetched profile data:",r),console.log("AdminPage: is_system_admin value:",r?.is_system_admin),r?.is_system_admin?(console.log("AdminPage: User is system admin."),y(!0),await _()):(console.log("AdminPage: User is NOT system admin."),g(!1))}catch(e){console.error("AdminPage: Error checking admin status (caught):",e),g(!1)}},_=async()=>{if(s){console.log("AdminPage: fetchBusinessStats function called.");try{let{data:e,error:r}=await s.from("businesses").select(`
          id,
          name,
          email,
          created_at,
          clients!businesses_business_id_fkey(count),
          invoices!businesses_business_id_fkey(count, total_amount)
        `);if(r){console.error("AdminPage: Error fetching business stats:",r),g(!1);return}console.log("AdminPage: Successfully fetched business data.",e);let a=(e||[]).map(e=>{let s=Array.isArray(e.clients)?e.clients.length:0,r=Array.isArray(e.invoices)?e.invoices:[],a=r.length,t=Array.isArray(r)?r.reduce((e,s)=>e+(s.total_amount||0),0):0;return{id:e.id,name:e.name,email:e.email,created_at:e.created_at,client_count:s,invoice_count:a,total_revenue:t}});n(a)}catch(e){console.error("Error fetching business stats:",e)}finally{g(!1)}}};return p?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),a.jsx("p",{className:"mt-4 text-gray-600",children:"Loading admin panel..."})]})}):b?a.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[a.jsx(j,{}),(0,a.jsxs)("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"System Admin Panel"}),a.jsx("p",{className:"text-gray-600 mt-2",children:"Overview of all businesses and their statistics"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,a.jsxs)(i.Zb,{children:[a.jsx(i.Ol,{className:"pb-3",children:a.jsx(i.ll,{className:"text-sm font-medium text-gray-600",children:"Total Businesses"})}),a.jsx(i.aY,{children:a.jsx("div",{className:"text-3xl font-bold",children:r.length})})]}),(0,a.jsxs)(i.Zb,{children:[a.jsx(i.Ol,{className:"pb-3",children:a.jsx(i.ll,{className:"text-sm font-medium text-gray-600",children:"Total Clients"})}),a.jsx(i.aY,{children:a.jsx("div",{className:"text-3xl font-bold",children:r.reduce((e,s)=>e+s.client_count,0)})})]}),(0,a.jsxs)(i.Zb,{children:[a.jsx(i.Ol,{className:"pb-3",children:a.jsx(i.ll,{className:"text-sm font-medium text-gray-600",children:"Total Invoices"})}),a.jsx(i.aY,{children:a.jsx("div",{className:"text-3xl font-bold",children:r.reduce((e,s)=>e+s.invoice_count,0)})})]}),(0,a.jsxs)(i.Zb,{children:[a.jsx(i.Ol,{className:"pb-3",children:a.jsx(i.ll,{className:"text-sm font-medium text-gray-600",children:"Total Revenue"})}),a.jsx(i.aY,{children:(0,a.jsxs)("div",{className:"text-3xl font-bold",children:["$",r.reduce((e,s)=>e+s.total_revenue,0).toFixed(2)]})})]})]}),(0,a.jsxs)(i.Zb,{children:[a.jsx(i.Ol,{children:a.jsx(i.ll,{children:"Business Overview"})}),a.jsx(i.aY,{children:(0,a.jsxs)(l,{children:[a.jsx(d,{children:(0,a.jsxs)(o,{children:[a.jsx(m,{children:"Business Name"}),a.jsx(m,{children:"Email"}),a.jsx(m,{children:"Created"}),a.jsx(m,{className:"text-center",children:"Clients"}),a.jsx(m,{className:"text-center",children:"Invoices"}),a.jsx(m,{className:"text-right",children:"Revenue"})]})}),a.jsx(c,{children:r.map(e=>(0,a.jsxs)(o,{children:[a.jsx(u,{className:"font-medium",children:e.name}),a.jsx(u,{children:e.email}),a.jsx(u,{children:(0,h.WU)(new Date(e.created_at),"MMM dd, yyyy")}),a.jsx(u,{className:"text-center",children:a.jsx(x.C,{variant:"secondary",children:e.client_count})}),a.jsx(u,{className:"text-center",children:a.jsx(x.C,{variant:"secondary",children:e.invoice_count})}),(0,a.jsxs)(u,{className:"text-right",children:["$",e.total_revenue.toFixed(2)]})]},e.id))})]})})]})]})}):a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)(i.Zb,{className:"w-full max-w-md",children:[a.jsx(i.Ol,{children:a.jsx(i.ll,{className:"text-center text-red-600",children:"Access Denied"})}),a.jsx(i.aY,{children:a.jsx("p",{className:"text-center text-gray-600",children:"You don't have permission to access the admin panel."})})]})})}},9591:(e,s,r)=>{"use strict";r.d(s,{C:()=>l});var a=r(5344);r(3729);var t=r(9247),i=r(1453);let n=(0,t.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l({className:e,variant:s,...r}){return a.jsx("div",{className:(0,i.cn)(n({variant:s}),e),...r})}},5094:(e,s,r)=>{"use strict";r.d(s,{z:()=>c});var a=r(5344),t=r(3729),i=r(2751),n=r(9247),l=r(1453);let d=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=t.forwardRef(({className:e,variant:s,size:r,asChild:t=!1,...n},c)=>{let o=t?i.g7:"button";return a.jsx(o,{className:(0,l.cn)(d({variant:s,size:r,className:e})),ref:c,...n})});c.displayName="Button"},3673:(e,s,r)=>{"use strict";r.d(s,{Ol:()=>l,SZ:()=>c,Zb:()=>n,aY:()=>o,ll:()=>d});var a=r(5344),t=r(3729),i=r(1453);let n=t.forwardRef(({className:e,...s},r)=>a.jsx("div",{ref:r,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));n.displayName="Card";let l=t.forwardRef(({className:e,...s},r)=>a.jsx("div",{ref:r,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",e),...s}));l.displayName="CardHeader";let d=t.forwardRef(({className:e,...s},r)=>a.jsx("h3",{ref:r,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",e),...s}));d.displayName="CardTitle";let c=t.forwardRef(({className:e,...s},r)=>a.jsx("p",{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",e),...s}));c.displayName="CardDescription";let o=t.forwardRef(({className:e,...s},r)=>a.jsx("div",{ref:r,className:(0,i.cn)("p-6 pt-0",e),...s}));o.displayName="CardContent",t.forwardRef(({className:e,...s},r)=>a.jsx("div",{ref:r,className:(0,i.cn)("flex items-center p-6 pt-0",e),...s})).displayName="CardFooter"},6540:(e,s,r)=>{"use strict";r.d(s,{I:()=>n});var a=r(5344),t=r(3729),i=r(1453);let n=t.forwardRef(({className:e,type:s,...r},t)=>a.jsx("input",{type:s,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:t,...r}));n.displayName="Input"},7361:(e,s,r)=>{"use strict";r.d(s,{_:()=>c});var a=r(5344),t=r(3729),i=r(4217),n=r(9247),l=r(1453);let d=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=t.forwardRef(({className:e,...s},r)=>a.jsx(i.f,{ref:r,className:(0,l.cn)(d(),e),...s}));c.displayName=i.f.displayName},5557:(e,s,r)=>{"use strict";r.r(s),r.d(s,{$$typeof:()=>i,__esModule:()=>t,default:()=>n});let a=(0,r(6843).createProxy)(String.raw`/Users/sekharcidambi/flex-pay-tracker-saas/src/app/admin/page.tsx`),{__esModule:t,$$typeof:i}=a,n=a.default}};var s=require("../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),a=s.X(0,[225,312,517,542],()=>r(9190));module.exports=a})();